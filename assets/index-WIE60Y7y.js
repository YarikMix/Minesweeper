var q=Object.defineProperty;var D=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>(D(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var c=(e=>(e[e.Custom=0]="Custom",e[e.Easy=1]="Easy",e[e.Medium=2]="Medium",e[e.Hard=3]="Hard",e))(c||{}),h=(e=>(e[e.Playing=0]="Playing",e[e.Lost=1]="Lost",e[e.Won=2]="Won",e))(h||{}),a=(e=>(e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden",e[e.Flagged=2]="Flagged",e))(a||{});let b=[];class P{constructor(t,n,l=!1,s=0,r=a.Hidden){v(this,"x");v(this,"y");v(this,"hasMine");v(this,"danger");v(this,"currentState");this.x=t,this.y=n,this.hasMine=l,this.danger=s,this.currentState=r}calcDanger(){let t=g[i.difficulty];for(let n=this.y-1;n<=this.y+1;n++)for(let l=this.x-1;l<=this.x+1;l++)l==this.x&&n==this.y||l<0||n<0||l>=t.width||n>=t.height||d[n*t.width+l].hasMine&&this.danger++}flag(){this.currentState==a.Hidden?this.currentState=a.Flagged:this.currentState==a.Flagged&&(this.currentState=a.Hidden),m.push(this)}click(){if(this.currentState==a.Hidden){if(this.hasMine&&!i.firstTry)A();else if(this.danger>0)this.currentState=a.Visible,m.push(this);else{this.currentState=a.Visible,m.push(this);let t=g[i.difficulty];for(b.push(this);b.length!=0;){const n=b.pop();for(let l=n.y-1;l<=n.y+1;l++)for(let s=n.x-1;s<=n.x+1;s++){if(s==n.x&&l==n.y||s<0||l<0||s>=t.width||l>=t.height)continue;let r=l*t.width+s;const o=d[r];o.currentState==a.Hidden&&(o.currentState=a.Visible,m.push({x:s,y:l,hasMine:o.hasMine,danger:o.danger,currentState:o.currentState}),o.danger==0&&b.push(o))}}}i.firstTry=!1,_()}}}let d=[],m=[],i={difficulty:c.Easy,state:h.Playing,tileW:10,tileH:10,firstTry:!0,optimizedRender:!1},g={[c.Custom]:{name:c.Custom,width:9,height:9,mines:10},[c.Easy]:{name:c.Easy,width:9,height:9,mines:10},[c.Medium]:{name:c.Medium,width:16,height:16,mines:40},[c.Hard]:{name:c.Hard,width:16,height:30,mines:99}};function _(){for(let e in d)if(!d[e].hasMine&&d[e].currentState!=a.Visible)return;i.state=h.Won,d.forEach(e=>{e.hasMine&&e.currentState==a.Hidden&&m.push(e)})}function A(){i.state=h.Lost,d.forEach(e=>{e.hasMine&&e.currentState==a.Hidden&&m.push(e)})}function J(){if(localStorage.getItem("save")){const e=JSON.parse(localStorage.getItem("save"));i=e.GameInfo,d=e.grid.map(t=>new P(t.x,t.y,t.hasMine,t.danger,t.currentState)),g=e.difficulties,O(),w(!0)}else L(c.Easy)}function O(){let e=g[i.difficulty];i.tileW=50,i.tileH=50,e.width*e.height>=1e5&&(i.tileW=10,i.tileH=10),p.width=i.tileW*e.width,p.height=i.tileH*e.height}function L(e){i.difficulty=e,i.state=h.Playing,i.firstTry=!0,d.length=0,m=[];let t=g[e];O();for(let n=0;n<t.height;n++)for(let l=0;l<t.width;l++)d.push(new P(l,n));w(!0)}function X(e=null){let t=g[i.difficulty],n=0;for(;n<t.mines;){let l=Math.floor(Math.random()*d.length);d[l].hasMine||e==l||(d[l].hasMine=!0,n++)}d.forEach(l=>{l.calcDanger()})}function W(e,t,n=!1){if(i.state==h.Won||i.state==h.Lost){L(i.difficulty);return}let l=g[i.difficulty],s=Math.floor(e/i.tileW),r=Math.floor(t/i.tileH);const o=s+r*l.width;i.firstTry&&X(o);const u=d[o];u.currentState!=a.Visible&&n?(u.flag(),w()):u.currentState==a.Hidden&&(u.click(),w())}function w(e=!1){console.log("render");let t=i.tileW/2,n=i.tileH/2,l=g[i.difficulty];V.innerText="üí£"+l.mines,i.state==h.Lost||i.state==h.Won?(x.classList.add("active"),x.innerText=i.state==h.Lost?"–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ üòî":"–í—ã –ø–æ–±–µ–¥–∏–ª–∏ ü•≥!"):(x.classList.remove("active"),x.innerText=""),f.font="bold 20px monospace",f.textAlign="center",f.textBaseline="middle";function s(r,o,u){(i.state==h.Lost||i.state==h.Won)&&r.hasMine?(f.fillStyle="#dddddd",f.fillRect(o,u,i.tileW,i.tileH),f.fillText("üí£",o+t,u+n)):r.currentState==a.Visible?(f.fillStyle="#dddddd",f.fillRect(o,u,i.tileW,i.tileH),r.danger&&(f.fillStyle="#000",f.fillText(r.danger.toString(),o+t,u+n))):(f.fillStyle="#ccc",f.fillRect(o,u,i.tileW,i.tileH),f.strokeRect(o,u,i.tileW,i.tileH),r.currentState==a.Flagged&&f.fillText("üö©",o+t,u+n))}i.optimizedRender&&!e?(m.forEach(r=>{let o=r.x*i.tileW,u=r.y*i.tileH;s(r,o,u)}),console.log("–†–µ–Ω–¥–µ—Ä–æ–≤: "+m.length),m=[]):(d.forEach(r=>{let o=r.x*i.tileW,u=r.y*i.tileH;s(r,o,u)}),console.log("–†–µ–Ω–¥–µ—Ä–æ–≤: "+d.length)),S.value=l.width.toString(),E.value=l.height.toString(),H.value=l.mines.toString(),M.value=c[i.difficulty],k.checked=i.optimizedRender,z()}function z(){try{localStorage.setItem("save",JSON.stringify({GameInfo:i,grid:d,difficulties:g}))}catch{console.log("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É")}}function B(e,t){let n=document.getElementById("game");do e-=n.offsetLeft,t-=n.offsetTop,n=n.offsetParent;while(n!=null);const l=p.parentElement;return[e+l.scrollLeft,t+l.scrollTop]}let f,p,T,C,M,N,S,E,H,V,x,k,R,y;function F(e){localStorage.setItem("darkmode",e)}function Y(){const e=localStorage.getItem("darkmode");y=document.querySelector(".darkmode-toggle__icon"),e?e=="true"&&(document.body.classList.add("darkmode"),y.classList.remove("fa-sun"),y.classList.add("fa-moon")):F(!1)}window.onload=function(){Y(),C=document.getElementById("click-type"),T=document.getElementById("reset-btn"),T.addEventListener("click",function(){L(i.difficulty)}),M=document.getElementById("difficulty-options"),M.addEventListener("change",function(e){const{value:t}=e.currentTarget;L(c[t])}),N=document.getElementById("apply-settings-btn"),N.addEventListener("click",function(e){e.preventDefault(),S.value=I(S.value,2,1e3),E.value=I(E.value,2,1e3),H.value=I(H.value,1,Number(S.value)*Number(E.value)-1),g[c.Custom].width=Number(S.value),g[c.Custom].height=Number(E.value),g[c.Custom].mines=Number(H.value),L(c.Custom)}),R=document.querySelector(".darkmode-toggle"),y=document.querySelector(".darkmode-toggle__icon"),R.addEventListener("click",function(){document.body.classList.toggle("darkmode"),F(document.body.classList.contains("darkmode")),document.body.classList.contains("darkmode")?(y.classList.remove("fa-sun"),y.classList.add("fa-moon")):(y.classList.remove("fa-moon"),y.classList.add("fa-sun"))}),S=document.getElementById("width"),E=document.getElementById("height"),H=document.getElementById("mines"),V=document.getElementById("mines-count"),k=document.getElementById("optimized-render-toggle"),k.addEventListener("change",function(e){const{checked:t}=e.target;console.log(t),i.optimizedRender=t,z()}),x=document.getElementById("game-state"),x.addEventListener("click",function(){L(i.difficulty)}),p=document.getElementById("game"),f=p.getContext("2d"),p.addEventListener("click",function(e){const t=C.value=="right",[n,l]=B(e.pageX,e.pageY);W(n,l,t)}),p.addEventListener("contextmenu",function(e){e.preventDefault();const[t,n]=B(e.pageX,e.pageY);return W(t,n,!0),!1}),J()};function I(e,t,n){const l=parseInt(e);return Math.min(Math.max(l,t),n).toString()}
