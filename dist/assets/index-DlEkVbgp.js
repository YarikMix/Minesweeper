var F=Object.defineProperty;var q=(e,t,i)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var p=(e,t,i)=>(q(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const I=500;var c=(e=>(e[e.Custom=0]="Custom",e[e.Easy=1]="Easy",e[e.Medium=2]="Medium",e[e.Hard=3]="Hard",e))(c||{}),h=(e=>(e[e.Playing=0]="Playing",e[e.Lost=1]="Lost",e[e.Won=2]="Won",e))(h||{}),d=(e=>(e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden",e[e.Flagged=2]="Flagged",e))(d||{});class P{constructor(t,i,l=!1,s=0,r=d.Hidden){p(this,"x");p(this,"y");p(this,"hasMine");p(this,"danger");p(this,"currentState");this.x=t,this.y=i,this.hasMine=l,this.danger=s,this.currentState=r}calcDanger(){let t=g[n.difficulty];for(let i=this.y-1;i<=this.y+1;i++)for(let l=this.x-1;l<=this.x+1;l++)l==this.x&&i==this.y||l<0||i<0||l>=t.width||i>=t.height||u[i*t.width+l].hasMine&&this.danger++}flag(){this.currentState==d.Hidden?this.currentState=d.Flagged:this.currentState==d.Flagged&&(this.currentState=d.Hidden),m.push(this)}click(){this.currentState==d.Hidden&&(this.hasMine&&!n.firstTry?A():this.danger>0?(this.currentState=d.Visible,m.push(this)):(this.currentState=d.Visible,m.push(this),this.revealNeighbours()),n.firstTry=!1,_())}revealNeighbours(){let t=g[n.difficulty];for(let i=this.y-1;i<=this.y+1;i++)for(let l=this.x-1;l<=this.x+1;l++){if(l==this.x&&i==this.y||l<0||i<0||l>=t.width||i>=t.height)continue;let s=i*t.width+l;const r=u[s];r.currentState==d.Hidden&&(r.currentState=d.Visible,m.push({x:l,y:i,hasMine:r.hasMine,danger:r.danger,currentState:r.currentState}),r.danger==0&&r.revealNeighbours())}}}let u=[],m=[],n={difficulty:c.Easy,state:h.Playing,tileW:50,tileH:50,firstTry:!0,optimizedRender:!1},g={[c.Custom]:{name:c.Custom,width:9,height:9,mines:10},[c.Easy]:{name:c.Easy,width:9,height:9,mines:10},[c.Medium]:{name:c.Medium,width:16,height:16,mines:40},[c.Hard]:{name:c.Hard,width:16,height:30,mines:99}};function _(){for(let e in u)if(!u[e].hasMine&&u[e].currentState!=d.Visible)return;n.state=h.Won}function A(){n.state=h.Lost,u.forEach(e=>{e.hasMine&&e.currentState==d.Hidden&&m.push(e)})}function D(){if(localStorage.getItem("save")){const e=JSON.parse(localStorage.getItem("save"));n=e.GameInfo,u=e.grid.map(t=>new P(t.x,t.y,t.hasMine,t.danger,t.currentState)),g=e.difficulties,H(!0)}else E(c.Easy)}function E(e){n.difficulty=e,n.state=h.Playing,n.firstTry=!0,u.length=0,m=[];let t=g[e];n.tileW=I/t.width,n.tileH=I/t.height;for(let l=0;l<t.height;l++)for(let s=0;s<t.width;s++)u.push(new P(s,l));let i=0;for(;i<t.mines;){let l=Math.floor(Math.random()*u.length);u[l].hasMine||(u[l].hasMine=!0,i++)}u.forEach(l=>{l.calcDanger()}),H(!0)}function W(e,t,i=!1){if(n.state==h.Won||n.state==h.Lost){E(n.difficulty);return}let l=g[n.difficulty],s=Math.floor(e/n.tileW),r=Math.floor(t/n.tileH);const o=s+r*l.width,f=u[o];f.currentState!=d.Visible&&i?(f.flag(),H()):f.currentState==d.Hidden&&(f.click(),H())}function H(e=!1){console.log("render");let t=n.tileW/2,i=n.tileH/2,l=g[n.difficulty];z.innerText="ðŸ’£"+l.mines,n.state==h.Lost||n.state==h.Won?(b.classList.add("active"),b.innerText=n.state==h.Lost?"Ð’Ñ‹ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»Ð¸ ðŸ˜”":"Ð’Ñ‹ Ð¿Ð¾Ð±ÐµÐ´Ð¸Ð»Ð¸ ðŸ¥³!"):(b.classList.remove("active"),b.innerText=""),a.font="bold 20px monospace",a.textAlign="center",a.textBaseline="middle";function s(r,o,f){(n.state==h.Lost||n.state==h.Won)&&r.hasMine?(a.fillStyle="#dddddd",a.fillRect(o,f,n.tileW,n.tileH),a.fillText("ðŸ’£",o+t,f+i)):r.currentState==d.Visible?(a.fillStyle="#dddddd",a.fillRect(o,f,n.tileW,n.tileH),r.danger&&(a.fillStyle="#000",a.fillText(r.danger.toString(),o+t,f+i))):(a.fillStyle="#ccc",a.fillRect(o,f,n.tileW,n.tileH),a.strokeRect(o,f,n.tileW,n.tileH),r.currentState==d.Flagged&&a.fillText("ðŸš©",o+t,f+i))}n.optimizedRender&&!e?(m.forEach(r=>{let o=r.x*n.tileW,f=r.y*n.tileH;s(r,o,f)}),console.log("Ð ÐµÐ½Ð´ÐµÑ€Ð¾Ð²: "+m.length),m=[]):(u.forEach(r=>{let o=r.x*n.tileW,f=r.y*n.tileH;s(r,o,f)}),console.log("Ð ÐµÐ½Ð´ÐµÑ€Ð¾Ð²: "+u.length)),v.value=l.width.toString(),S.value=l.height.toString(),x.value=l.mines.toString(),M.value=c[n.difficulty],w.checked=n.optimizedRender,O()}function O(){localStorage.setItem("save",JSON.stringify({GameInfo:n,grid:u,difficulties:g}))}function B(e,t){let i=document.getElementById("game");do e-=i.offsetLeft,t-=i.offsetTop,i=i.offsetParent;while(i!=null);return[e,t]}let a,L,N,C,M,T,v,S,x,z,b,w,R,y;function V(e){localStorage.setItem("darkmode",e)}function J(){const e=localStorage.getItem("darkmode");y=document.querySelector(".darkmode-toggle__icon"),e?e=="true"&&(document.body.classList.add("darkmode"),y.classList.remove("fa-sun"),y.classList.add("fa-moon")):V(!1)}window.onload=function(){J(),C=document.getElementById("click-type"),N=document.getElementById("reset-btn"),N.addEventListener("click",function(){E(n.difficulty)}),M=document.getElementById("difficulty-options"),M.addEventListener("change",function(e){const{value:t}=e.currentTarget;E(c[t])}),T=document.getElementById("apply-settings-btn"),T.addEventListener("click",function(e){e.preventDefault(),v.value=k(v.value,2,30),S.value=k(S.value,2,30),x.value=k(x.value,1,Number(v.value)*Number(S.value)-1),g[c.Custom].width=Number(v.value),g[c.Custom].height=Number(S.value),g[c.Custom].mines=Number(x.value),E(c.Custom)}),R=document.querySelector(".darkmode-toggle"),y=document.querySelector(".darkmode-toggle__icon"),R.addEventListener("click",function(){document.body.classList.toggle("darkmode"),V(document.body.classList.contains("darkmode")),document.body.classList.contains("darkmode")?(y.classList.remove("fa-sun"),y.classList.add("fa-moon")):(y.classList.remove("fa-moon"),y.classList.add("fa-sun"))}),v=document.getElementById("width"),S=document.getElementById("height"),x=document.getElementById("mines"),z=document.getElementById("mines-count"),w=document.getElementById("optimized-render-toggle"),w.addEventListener("change",function(e){console.log("change");const{checked:t}=e.target;console.log(t),n.optimizedRender=t,O()}),b=document.getElementById("game-state"),b.addEventListener("click",function(){E(n.difficulty)}),L=document.getElementById("game"),a=L.getContext("2d"),L.addEventListener("click",function(e){const t=C.value=="right",[i,l]=B(e.pageX,e.pageY);W(i,l,t)}),L.addEventListener("contextmenu",function(e){e.preventDefault();const[t,i]=B(e.pageX,e.pageY);return W(t,i,!0),!1}),a.fillStyle="#ddddee",a.fillRect(0,0,I,I),D()};function k(e,t,i){const l=parseInt(e);return Math.min(Math.max(l,t),i).toString()}
